from __future__ import print_function
from tweepy.streaming import StreamListener
from tweepy import OAuthHandler
from tweepy import Stream



# writing tweets and related data into file

class StdOutListener(StreamListener):
	global fn
	fn=open("raw_tweets_data.txt","a")
	def on_data(self,data):
		print(data,file=fn)
		return True
	def on_error(self,status):
		print(status,file=fn)


class tweepy_app:
	# authenciating the app and streaming	
	def run_app(self,tag_name,file_name):
		self.tag_name=tag_name
		self.file_name=file_name
		f=open(self.file_name,"r") #extract passwords from a different file-comparitively safer
		a=f.read().splitlines()
		access_token,access_token_secret,consumer_key,consumer_secret=a
		f.close()
		l=StdOutListener()
		auth =OAuthHandler(consumer_key, consumer_secret)
		auth.set_access_token(access_token, access_token_secret)
		stream=Stream(auth,l,language='en',filter_level="medium")
		stream.filter(track=[tag_name])#filtering tweets based on topic
		
	




'''
#reading JSON(format of raw tweets)
twi_data_path="twi_2.txt"
tweets_data=[]
file=open(twi_data_path,"r")
for i in file:
	try:
		tweet=json.loads(i)
		tweets_data.append(tweet)
	except:
		continue

# creating a pandas dataframe for better structuring 
tweets=pd.DataFrame()
tweets['text'] = [tweet.get('text','') for tweet in tweets_data]
# Similarly give all the fields you reqire into the dataframe


#Sentiment analysis using vader package from nltk
analyser=SentimentIntensityAnalyzer()
tweets["neg"]=[(analyser.polarity_scores(i)['neg']) for i in tweets['text']]
tweets["new"]=[(analyser.polarity_scores(i)['neu']) for i in tweets['text']]
tweets["pos"]=[(analyser.polarity_scores(i)['pos']) for i in tweets['text']]
tweets["compound"]=[(analyser.polarity_scores(i)['compound']) for i in tweets['text']]
'''

